image: php:8.2

stages:
  - build
  - test
  - deploy

before_script:
  - apt-get update && apt-get install -y unzip git curl libzip-dev libssl-dev pkg-config gnupg
  - mkdir -p /usr/local/etc/php/conf.d
  - curl -O https://pecl.php.net/get/mongodb-2.0.0.tgz
  - tar -xzf mongodb-2.0.0.tgz
  - cd mongodb-2.0.0 && phpize && ./configure && make && make install && cd ..
  - echo "extension=mongodb.so" > /usr/local/etc/php/conf.d/mongodb.ini
  - curl -sS https://getcomposer.org/installer | php
  - mv composer.phar /usr/local/bin/composer

build_app:
  stage: build
  script:
    - echo "ğŸ“¦ Installing PHP dependencies"
    - cd backend
    - composer install
    - cd ..
    - echo "âœ… Backend Build complete"
  only:
    - main

build_frontend:
  stage: build
  image: node:18
  script:
    - echo "âš›ï¸ Building React frontend"
    - cd client
    - npm install
    - npm run build
    - echo "âœ… Frontend build complete"
  only:
    - main

test_app:
  stage: test
  script:
    - echo "âœ… No tests yet"
  only:
    - main

deploy_app:
  stage: deploy
  script:
    - echo "ğŸš€ Deployment step goes here"
  only:
    - tags

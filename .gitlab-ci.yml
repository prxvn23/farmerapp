stages:
  - build
  - test
  - deploy

image: php:8.2

before_script:
  - apt-get update && apt-get install -y unzip git curl libzip-dev zlib1g-dev pkg-config libssl-dev libcurl4-openssl-dev
  - pecl install mongodb
  - docker-php-ext-enable mongodb
  - curl -sS https://getcomposer.org/installer | php
  - mv composer.phar /usr/local/bin/composer

build_app:
  stage: build
  script:
    - echo "Installing PHP dependencies"
    - cd backend
    - composer install
    - cd ..
    - echo "✅ Build done"

test_app:
  stage: test
  script:
    - echo "No tests yet"
    - echo "✅ Test stage passed"

deploy_app:
  stage: deploy
  script:
    - echo "Deployment script (optional)"
  only:
    - tags
